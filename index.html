<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Game ƒêua Ng·ª±a</title>
<style>
body {
    font-family: Arial, sans-serif;
    text-align: center;
    background: #4CAF50;
    color: white;
}
#joinSection {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.85);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    z-index: 999;
}
.track {
    width: 1200px;
    height: 60px;
    border: 2px solid #fff;
    margin: 10px auto;
    position: relative;
    background: #388E3C;
    overflow: hidden;
}
.horse {
    position: absolute;
    top: 5px;
    left: 0;
    width: 50px;
    height: 50px;
}
.finish-line {
    position: absolute;
    right: 0;
    top: 0;
    width: 10px;
    height: 100%;
    background: red;
}
.controls {
    margin: 15px;
}
</style>
</head>
<body>
<div id="joinSection">
    <h1>Tham gia nh√≥m Telegram ƒë·ªÉ ch∆°i</h1>
    <a href="https://t.me/htuanpremium0" target="_blank">
        <button id="joinBtn" style="padding:15px 30px;font-size:20px;">Tham Gia</button>
    </a>
</div>
<h1>üèá Game ƒêua Ng·ª±a</h1>
<div class="controls">
    S·ªë d∆∞: <span id="balance">10000</span> | 
    C∆∞·ª£c: <input type="number" id="betAmount" value="100" min="1"> |
    Ch·ªçn ng·ª±a: <select id="betHorse"></select>
    <button id="startBtn">B·∫Øt ƒë·∫ßu</button>
    <button id="resetBtn" disabled>Ch∆°i l·∫°i</button>
</div>
<div id="tracks"></div>
<h2 id="result"></h2>
<script>
let balance = 10000;
let horses = [];
let numHorses = 8;
const minDuration = 15000;
const maxDuration = 20000;
const updateInterval = 30;
const tracksEl = document.getElementById('tracks');
const balanceEl = document.getElementById('balance');
const betAmountEl = document.getElementById('betAmount');
const betHorseEl = document.getElementById('betHorse');
const resultEl = document.getElementById('result');
const startBtn = document.getElementById('startBtn');
const resetBtn = document.getElementById('resetBtn');
const joinSection = document.getElementById('joinSection');
const joinBtn = document.getElementById('joinBtn');

for(let i=1; i<=numHorses; i++){
    const track = document.createElement('div');
    track.className = 'track';
    const horse = document.createElement('img');
    horse.src = 'horse.png';
    horse.className = 'horse';
    const finish = document.createElement('div');
    finish.className = 'finish-line';
    track.appendChild(horse);
    track.appendChild(finish);
    tracksEl.appendChild(track);
    horses.push({el: horse, speed: 0, pos: 0});
    const opt = document.createElement('option');
    opt.value = i;
    opt.textContent = 'Ng·ª±a ' + i;
    betHorseEl.appendChild(opt);
}

function updateBalanceDisplay(showAlert = true){
    balanceEl.textContent = balance;
    if(showAlert && balance <= 0){
        alert("B·∫°n ƒë√£ h·∫øt ti·ªÅn!");
    }
}

joinBtn.addEventListener('click', ()=>{
    joinSection.style.display = 'none';
});

startBtn.addEventListener('click', ()=>{
    const bet = parseInt(betAmountEl.value);
    const betHorse = parseInt(betHorseEl.value);
    if(bet > balance || bet <= 0){
        alert("C∆∞·ª£c kh√¥ng h·ª£p l·ªá!");
        return;
    }
    balance -= bet;
    updateBalanceDisplay(false); // Kh√¥ng b√°o h·∫øt ti·ªÅn khi v·ª´a tr·ª´ c∆∞·ª£c
    resultEl.textContent = '';
    startBtn.disabled = true;
    betAmountEl.disabled = true;
    betHorseEl.disabled = true;
    horses.forEach(h=> {h.el.style.left = '0px'; h.pos = 0;});
    const laneWidth = tracksEl.querySelector('.track').clientWidth;
    const finishX = laneWidth - 60;
    let finished = [];

    // Ch·ªçn th·ª© t·ª± ng·∫´u nhi√™n
    let order = Array.from({length: numHorses}, (_, i) => i);
    order.sort(() => Math.random() - 0.5);

    // G√°n th·ªùi gian ch·∫°y
    let durations = [];
    for (let i = 0; i < numHorses; i++) {
        durations.push(minDuration + Math.random() * (maxDuration - minDuration));
    }
    durations.sort((a,b) => a - b);

    let horseDurations = [];
    for (let i = 0; i < numHorses; i++) {
        horseDurations[order[i]] = durations[i];
    }

    horses.forEach((h, idx) => {
        let totalSteps = horseDurations[idx] / updateInterval;
        h.speed = finishX / totalSteps;
    });

    let raceInterval = setInterval(()=>{
        horses.forEach((h,i)=>{
            if(finished.includes(i)) return;
            h.pos += h.speed;
            if(h.pos >= finishX){
                h.pos = finishX;
                finished.push(i);
            }
            h.el.style.transform = `translateX(${h.pos}px)`;
        });

        if(finished.length === numHorses){
            clearInterval(raceInterval);
            let top1 = finished[0]+1;
            let top2 = finished[1]+1;
            let top3 = finished[2]+1;
            resultEl.textContent = `üèÜ 1st: Ng·ª±a ${top1} (x4) | 2nd: Ng·ª±a ${top2} (x3) | 3rd: Ng·ª±a ${top3} (x2)`;
            if(betHorse === top1) balance += bet*4;
            else if(betHorse === top2) balance += bet*3;
            else if(betHorse === top3) balance += bet*2;
            updateBalanceDisplay(true); // Ch·ªâ b√°o h·∫øt ti·ªÅn khi k·∫øt th√∫c v√°n
            startBtn.disabled = false;
            resetBtn.disabled = false;
            betAmountEl.disabled = false;
            betHorseEl.disabled = false;
        }
    }, updateInterval);
});

resetBtn.addEventListener('click', ()=>{
    horses.forEach(h=> {h.el.style.left = '0px'; h.pos = 0;});
    resultEl.textContent = '';
    resetBtn.disabled = true;
});
updateBalanceDisplay(false);
</script>
</body>
</html>
